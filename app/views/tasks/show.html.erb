<h5>
  CI task #<%= @task.id %>
  <small class="text-body-secondary">created <%= time_ago_in_words(@task.created_at) %> ago</small>
</h5>

<div class="container pt-3">

  <div class="pb-3 text-secondary">
    <%= @task.state.capitalize %>
    <% unless @task.scheduled? %>
      <span>on <%= @task.agent.name %></span>
    <% end %>
    <%= time_ago_in_words(@task.updated_at) %> ago
  </div>

  <h6>Artefacts</h6>
  <div class="vstack gap-3">

    <% @task.artefacts.group_by(&:distro).sort_by { |i| d = ::Distro[i.first]; [d.family, d.name] }.each do |distro, afacts| %>
      <div class="card">
        <div class="card-header">
          <%= render partial: 'layouts/distro_icon', locals: { family: ::Distro[distro].family, size: 24 } %>
          <%= ::Distro[distro].name %>
          <% if afacts.any?(&:error?) %>
            <span class="badge text-bg-danger">ERRORS<span>
          <% end %>
        </div>

        <div class="card-body">
          <table class="table table-sm">

            <thead>
              <tr>
                <th scope="col">File</th>
                <th scope="col">Content type</th>
                <th scope="col">Size</th>
                <th scope="col">Created at</th>
              </tr>
            </thead>

            <tbody>
              <% afacts.each do |afact| %>
                <tr>
                  <td><%= link_to afact.filename, rails_blob_path(afact.attachment.blob, disposition: 'attachment') %></td>
                  <td><%= afact.attachment.content_type %></td>
                  <td><%= number_to_human_size(afact.attachment.byte_size) %></td>
                  <td><%= afact.attachment.blob.created_at %></td>
                </tr>
              <% end %>

            </tbody>
          </table>

        </div>
      </div>
    <% end %>

  </div>

</div>
